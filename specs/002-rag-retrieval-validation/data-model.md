# Data Model: RAG Retrieval and Validation System

## Vector Record Model

### Entity: VectorRecord
Represents a single vector chunk with its associated metadata and embedding data.

**Fields**:
- `id` (string): Unique identifier for the vector chunk
- `embedding` (list[float]): Cohere embedding vector data
- `metadata` (dict): Contains URL, module, section, position, hash, source text
  - `url` (string): The source URL of the content
  - `module` (string): The module name where the content belongs
  - `section` (string): The section name within the module
  - `position` (int): The position/index of this chunk in the original content
  - `hash` (string): Hash of the source content for integrity verification
  - `source_text` (string): The original text that was embedded
- `timestamps` (dict):
  - `ingestion` (datetime): When the vector was ingested
  - `retrieval` (datetime): When the vector was last retrieved (for tracking)

### Relationships
- Each VectorRecord is uniquely identified by its `id`
- Multiple VectorRecords can belong to the same `url`, `module`, or `section`
- VectorRecords are stored in Qdrant vector database

## Validation Report Model

### Entity: ValidationReport
Represents the results of a validation run, including statistics, details, and errors.

**Fields**:
- `id` (string): Unique identifier for this validation report
- `timestamp` (datetime): When the validation was performed
- `summary` (dict): Overall validation statistics and success rates
  - `total_vectors` (int): Total number of vectors processed
  - `successful_retrievals` (int): Number of successful retrievals
  - `failed_retrievals` (int): Number of failed retrievals
  - `success_rate` (float): Percentage of successful operations
  - `validation_type` (string): Type of validation performed (e.g., "metadata_integrity", "similarity_check")
- `details` (list[dict]): Individual record validation results
  - `vector_id` (string): ID of the vector being validated
  - `status` (string): "success" or "failure"
  - `validation_steps` (list[dict]): Results of individual validation steps
- `errors` (list[dict]): List of failed validations with error details
  - `vector_id` (string): ID of the failed vector
  - `error_type` (string): Type of error (e.g., "metadata_mismatch", "similarity_low")
  - `error_message` (string): Detailed error message
  - `context` (dict): Additional context about the error
- `metrics` (dict): Performance and quality metrics
  - `execution_time` (float): Time taken to complete validation (seconds)
  - `queries_per_second` (float): Performance metric
  - `similarity_threshold` (float): Threshold used for similarity checks
  - `average_similarity_score` (float): Average similarity score across all checks

### Relationships
- Each ValidationReport contains multiple validation results
- ValidationReports are generated by validation service operations
- Reports can be linked to specific validation runs or time periods

## API Request/Response Models

### Request: VectorRetrievalRequest
**Fields**:
- `identifier_type` (string): "url", "module", or "section"
- `identifier_value` (string): The actual value to search for
- `limit` (int, optional): Maximum number of vectors to return
- `offset` (int, optional): Offset for pagination

### Response: VectorRetrievalResponse
**Fields**:
- `vectors` (list[VectorRecord]): Retrieved vector records
- `count` (int): Total number of vectors returned
- `query_time` (float): Time taken to execute the query (seconds)

### Request: ValidationRequest
**Fields**:
- `validation_type` (string): Type of validation to perform
- `parameters` (dict): Additional parameters for the validation
  - `url` (string, optional): Specific URL to validate
  - `module` (string, optional): Specific module to validate
  - `threshold` (float, optional): Threshold for similarity checks

### Response: ValidationResponse
**Fields**:
- `report` (ValidationReport): The generated validation report
- `status` (string): "completed", "in_progress", "failed"